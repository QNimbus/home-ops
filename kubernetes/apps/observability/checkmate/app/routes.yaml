---
# HTTPRoute for Checkmate Client (Frontend)
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: checkmate-client
  annotations:
    gethomepage.dev/enabled: "true"
    gethomepage.dev/group: "Observability"
    gethomepage.dev/name: "Checkmate"
    gethomepage.dev/icon: "https://raw.githubusercontent.com/bluewave-labs/checkmate/main/client/public/logo512.png"
    nginx.ingress.kubernetes.io/auth-method: GET
    nginx.ingress.kubernetes.io/auth-url: http://authelia.security.svc.cluster.local/api/verify
    nginx.ingress.kubernetes.io/auth-signin: "https://auth.${DOMAIN_ID}?rm=$request_method"
    nginx.ingress.kubernetes.io/auth-response-headers: Remote-User,Remote-Name,Remote-Email,Remote-Groups
    nginx.ingress.kubernetes.io/auth-snippet: proxy_set_header X-Forwarded-Method $request_method;
spec:
  parentRefs:
    - name: internal
      namespace: kube-system
      sectionName: https-app
  hostnames:
    - "${GATUS_DOMAIN:=${GATUS_SUBDOMAIN:=${APP}}.${DOMAIN_APP}}"
  rules:
    - backendRefs:
        - name: checkmate-client
          port: 80

---
# HTTPRoute for Checkmate Server (API)
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: checkmate-server
  annotations:
    nginx.ingress.kubernetes.io/cors-allow-origin: "https://${GATUS_DOMAIN:=${GATUS_SUBDOMAIN:=${APP}}.${DOMAIN_APP}}"
    nginx.ingress.kubernetes.io/enable-cors: "true"
spec:
  parentRefs:
    - name: internal
      namespace: kube-system
      sectionName: https-app
  hostnames:
    - "checkmate-api.${DOMAIN_APP}"
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api
      backendRefs:
        - name: checkmate-server
          port: 52345
